
Как-то столкнулся с такой проблемой, что в ходе разработки обменов с сервисом Яндекс.Директ начисто пропало "взаимопонимание" скриптов со службой API. Перепроверив все возможное на ошибки обратился в службу поддержки. Вместе со специалистом поддержки еще раз перепроверили - все должно работать, однако не работает. В конце концов саппорт предложил мне проверить и заменить авторизационные токены и вообще регистрацию приложения в OAuth Яндекса. При проверке оказалось что данные по регистрации приложения отсутствую, а значит и токены недействительны. Специалист тогда честно сказал, что у них был сбой в БД и соответственно видимо откатом данные не всех пользователей удалось восстановить - ну это уже не важно.

Дабы впредь не попадать в подобные глупые ситуации я решил разработать скрипт для тестирования всего-чего возможно: соединения, авторизации, версий и проч. Скрипт который бы "железно" работал и по результатам работы которого можно было бы выстроить картину и определить причину возможных сбоев. Возможно кому-то он тоже пригодится.

Первоначальная идея скрипта довольно проста, без претензий. Никаких фреймворков, библиотек и прочего. Никакого интерфейса - все настройки через конфигурационный файл и переменные/массивы переменных в самом скрипте.

Файл настроек yd-common-check-constants.php с основными, не меняемыми настройками.  
yd-common-check-urls.php содержит массив с URL интересующих нас протоколов и версий Яндекс.Директ. Ненужные - комментируем, нужные - раскоменчиваем.
Ну и собственно сам скрипт yd-common-check.php. Без параметров скрипт проверяет функциями указанными по-умолчанию, но можно и указать функцию для проверки.

Предупреждение! Скрипт рекомендуется использовать только для диагностики и в ознакомительных целях. Крайне опасно оставлять его в открытом доступе! Данный скрипт выдает дампы используемых объектов, из которых могут быть легко получены полные данные по авторизации в сервисах Яндекс, поэтому категорически рекомендуется удалять скрипт из открытого доступа после окончания работ и диагностики.

WHATS NEW:

version 0.1.1-dev
  - DONE: ~ 26.03.2012 21:25:59 SOAP.SSL API version: v4 ( ! ) Fatal error: Cannot redeclare newSoapClient() (previously declared in yd-common-check.php:189) in yd-common-check.php on line 189
  - TODO: ~ 28.03.2012 15:03:18 заголовок SOAP:Header для авторизаци SOAP+OAUTH:
        <SOAP-ENV:Header>
        <locale>ru</locale>
        <login>YANDEX_DIRECT_LOGIN</login>
        <token>YANDEX_OAUTH_APPLICATION_DEVELOPER_TOKEN</token>
        <application_id>YANDEX_OAUTH_APPLICATION_ID</application_id>
        </SOAP-ENV:Header>
